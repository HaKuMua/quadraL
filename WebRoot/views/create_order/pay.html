<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>确认并支付</title>
		<script src="../../js/comment.js"></script>
		<script src="../../js/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
		<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
		<script src="../../layui/layui.js"></script>
		<style type="text/css">
			#warpper{
				margin-top: 70px;
				margin-left: 450px;
				width: 600px;
			}
			#tip{
				width: 600px;
				height: 70px;
				margin-top: 30px;
				border:1px solid #000000;
			}
			#checkIn{
				margin-top: 30px;
			}
			.formSe div{
				width: 400px;
			}
			
			.formSe input,#typeId input{
				height: 60px;
				font-size: 16px;
			}
			#typeId div{
				width: 140px;
			}
			
			
			#rightNav{
				position: relative;
				margin-left: 1150px;
				margin-top: -540px;
				
			}
			#house{
				position: absolute;
				width: 350px;
				border:1px solid #000000;
			}
			#notice{
				position: absolute;
				margin-top: 490px;
				width: 350px;
				border:1px solid #000000;
			}
			#sec{
				position: absolute;
				margin-top: 720px;
				width: 350px;
				height: 130px;
				border:1px solid #000000;
			}
			#sec1{
				position: absolute;
				margin-top: 880px;
				width: 350px;
				height: 120px;
				border:1px solid #000000;
			}
			#sec2{
				position: absolute;
				margin-top: 1030px;
				width: 350px;
				height: 120px;
				border:1px solid #000000;
			}
			#house div,#notice div,#sec div,#sec1 div,#sec2 div{
				margin-left: 20px;
			}
			.foot {
				margin-top:1300px;
				width: 1090px;
				margin-left: 550px;
			}
		</style>
	</head>
	<body>
		<div style=" line-height:40px;z-index: 100; width: 100%;height: 60px; background-color: #EBEBEB;">
				<a href="../index.html" >
					<img src="../../img/logo.jpg" class="layui-nav-img"  style="margin-top:10px;">
				</a>
				<a href="payments.html"></a>
				<h3 style="position: absolute; margin-top: -30px; margin-left: 60px;">1 预订您的行程 &nbsp;<b>2 确认并支付</b></h3>
		</div>	
		<div id="warpper">
			<span style="font-weight: bolder; font-size: 35px; color: gray;">
				确认并支付
			</span><br><br>
			<div id="tip">
				<div class="layui-col-xs2">
					<img src="../../img/tag/7.gif"  height="70px">
				</div>
				<div id="landlord_name" style="margin-top: 20px;" class="layui-col-xs10">
					<h2>这是一个抢手房源。藝的房源通常很抢手。</h2>
				</div>	
			</div><br><br><br>	
			<div  >
				<h2>选择付款方式</h2><br><br>
				<div class="layui-col-xs4">
					<button type="button" class="layui-btn layui-bg-green chooseBtn"
					style= "  width: 120px;height: 70px; font-size: 20px;">余额</button>
				</div>
				<div  class="layui-col-xs4">
					<button type="button" class="layui-btn layui-btn-primary chooseBtn"
					style= " width: 120px;height: 70px; font-size: 20px;">支付宝</button>
				</div>	
				<div  class="layui-col-xs4">
					<button  type="button" class="layui-btn layui-btn-primary chooseBtn"
					style= " width: 120px;height: 70px; font-size: 20px;">微信</button>
				</div>
				<h3 style= " margin-top:100px;" >我同意房屋守则, 取消政策,和房客退款政策，
				我也同意支付以下所示的总金额（含服务费）。</h3>
			</div>
			
			<button id="payBtn" type="button" class="layui-btn layui-bg-red layui-btn-radius" 
			style= " margin-top:100px; width: 160px;height: 50px; font-size: 20px;">确认并支付</button>
		</div>
		<div id="rightNav">
			<div id="house">
					<br>
					<div class="layui-col-xs7">
						<h2><b>藝净- 复古花,太古里旁高层花园电影套房</b></h2><br>
						<h3>成都的整套公寓</h3>
					</div>
					<div class="layui-col-xs3">
						<img src="../../img/room/997b02ab-9522-4500-a0de-6e67a94bbe9b.jpg" width="100px" >
					</div>
					<hr ><br><br>
					<div >
					<h2>人数：1人</h2><br>
					<h2>时间：2019年12月7日 - 2019年12月8日</h2>
					<hr ><br><br>
					</div>
					<div class="layui-col-xs6">
						<h2>￥558.00 x1晚</h2>
					</div>
					<div class="layui-col-xs3">
						<h2>￥558.00</h2>
					</div>
					<hr ><br>
					<div class="layui-col-xs6">
						<h2><b>总价	</b></h2>
					</div>
					<div class="layui-col-xs3">
						<h2>￥1110.00</h2>
					</div>
				
			</div>
			<div id="notice">
				<div >
					<br>
					<h2><b>入住须知</b></h2><br>
					<h2>不允许携带宠物<br>	
						不允许举办派对和活动<br>
						14:00后可以随时入住<br>
						12:00前退房
					</h2>
				</div>
			</div>
			<div id="sec">
				<br>
				<div class="layui-col-xs5">
					<h2><b>QuadraL旅行保障</b></h2>
					<h4>房源保障 · 中文客服 · 安全保障</h4>
				</div>
				<div class="<layui-col-xs5></layui-col-xs5>">
					<img src="../../img/tag/3.svg" width="100px" >
				</div>
			</div>
			<div id="sec1">
				<br><br>
				<div class="layui-col-xs12">
					<h2><b>安全须知</b></h2>
					<h3>该房源未安装一氧化碳报警器</h3>
				</div>
			</div>
			<div id="sec2">
				<br>
				<div class="layui-col-xs12">
					<h2><b>发票</b></h2>
					<h4>若需要开具房费发票，请您与房东协商</h4>
				</div>
			</div>
		</div>
		<div class="foot" >
			<div >
				<div>京ICP备16017121号-3 京ICP证 160773号 
				<img src="https://z1.muscache.cn/airbnb/static/packages/public_security_bureau_logo.d0289dc0.png"
					 alt="中国公安局标志"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502032345" target="_blank"
					 rel="noopener noreferrer"  aria-busy="false">京公网安备 11010502032345号</a>
					技术支持：卓应教育（湖南）有限公司 <a href="https://a0.muscache.com/pictures/03ec62da-f467-4e2b-bfee-6eefd052d7f5.jpg" target="_blank"
					 rel="noopener noreferrer"  aria-busy="false">营业执照</a></div>
				<div dir="ltr" >© 2019 Airbnb, Inc. All rights reserved.</div>
			</div>
			<br><br><br><br><br><br>
		</div>
	</body>
	<script>
		layui.use(['form', 'layedit','layer'], function(){
			var form = layui.form
			,layer = layui.layer
		});
	</script>
	<script>
		//获取Cookie
		function getCookie(cname) {
		    var name = cname + "=";
		    var decodedCookie = decodeURIComponent(document.cookie);
		    var ca = decodedCookie.split(';');
		    for(var i = 0; i <ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0) == ' ') {
		            c = c.substring(1);
		         }
		         if (c.indexOf(name) == 0) {
		            return c.substring(name.length, c.length);
		         }
		     }
		    return "";
		} 
		var info=getCookie('personInfo');
		myCookie=getCookie('orderInfo');
		orderInfo = JSON.parse(myCookie);
		console.log(orderInfo);
		getInfo(orderInfo);
		$('#btnGo').on('click', function() {
			$.cookie('mySpace', mySpace);
			location.href = "houseImage.html";
		});
		
		$('#payBtn').on('click',function() {
			map='{"landlord":"'+orderInfo.landlord+'","user_id":"'+orderInfo.user_id+'","price":"'+orderInfo.price+
			'","reserve_date":"'+orderInfo.startTime+'","reserve_day_number":"'+orderInfo.dayNumber+
			'","check_out_date":"'+orderInfo.endTime+'","house_id":"'+orderInfo.house_id+
			'","grogshop_order_describe":"牛批"}';
			console.log(info)
			console.log(map)
			$.getJSON(basePath + "order.do?method=addOrderInfo&callback=?", {
				"grogshopOrderInfo":map,"checkInPersonInfo":info
			}, function(result) {
				code = result.hint;
				console.log(code)
				if(code == -2) {
					layer.msg("未知原因，支付失败！");
				}else if(code == -1){
					layer.msg("余额不足，支付失败！");
					html='<div style="width: 500px;height: 420px;">'+
						'<div style="text-align: center;"><br><br><h1>QUADRAL币</h1><h2>充值人：'+orderInfo.user_id+'</h2><br><hr ></div>'+
						'<div ><h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;充值金额：</h4><br><div class="layui-col-xs12">'+
						'&nbsp;&nbsp;&nbsp;<button style="width: 110px;height: 50px;" type="button" class="layui-btn layui-bg-green moneyBtn">￥500</button>'+
						'<button  style="width: 110px;height: 50px;" type="button" class="layui-btn layui-btn-primary  moneyBtn">￥1000</button>'+
						'<button style="width: 110px;height: 50px;" type="button" class="layui-btn layui-btn-primary  moneyBtn">￥1000</button>'+
						'<button style="width: 110px;height: 50px;" type="button" class="layui-btn layui-btn-primary  moneyBtn">￥2000</button>'+
						'</div><div  style="text-align: center;"><h3>请用支付宝扫码：</h3><br><img src="../../img/pay.jpg"  width="180px"></div></div></div>';
					window.setTimeout (function() {
						recharge(html);
					},1500);
				}else if(code >0) {
					layer.msg("支付成功！正在跳转");
					window.setTimeout (function() {
						//跳转界面
						location.href = "../user/myOrder.html";
					},1500);
				}
				
			});
		})
		
		// $('#payBtn').on('click',function() {
		// 	https://openapi.alipay.com/gateway.do?timestamp=2013-01-01 08:08:08&method=alipay.trade.page.pay&app_id=16054&sign_type=RSA2&sign=ERITJKEIJKJHKKKKKKKHJEREEEEEEEEEEE&version=1.0&charset=GBK&biz_content={"time_expire":"2016-12-31 10:05:01","extend_params":{"sys_service_provider_id":"2088511833207846","hb_fq_seller_percent":"100","hb_fq_num":"3","industry_reflux_info":"{\\\"scene_code\\\":\\\"metro_tradeorder\\\",\\\"channel\\\":\\\"xxxx\\\",\\\"scene_data\\\":{\\\"asset_name\\\":\\\"ALIPAY\\\"}}","card_type":"S0JP0000"},"settle_info":{"settle_detail_infos":[{"amount":0.1,"trans_in":"A0001","settle_entity_type":"SecondMerchant??Store","summary_dimension":"A0001","settle_entity_id":"2088xxxxx;ST_0001","trans_in_type":"cardAliasNo"}]},"subject":"Iphone6 16G","product_code":"FAST_INSTANT_TRADE_PAY","body":"Iphone6 16G","qr_pay_mode":"1","integration_type":"PCWEB","merchant_order_no":"20161008001","sub_merchant":{"merchant_id":"19023454","merchant_type":"alipay: ???????????????????, merchant: ???????????????"},"invoice_info":{"key_info":{"tax_num":"1464888883494","is_support_invoice":true,"invoice_merchant_name":"ABC|003"},"details":"[{\"code\":\"100294400\",\"name\":\"????\",\"num\":\"2\",\"sumPrice\":\"200.00\",\"taxRate\":\"6%\"}]"},"ext_user_info":{"cert_type":"IDENTITY_CARD","cert_no":"362334768769238881","name":"????","mobile":"16587658765","fix_buyer":"F","min_age":"18","need_check_info":"F"},"timeout_express":"90m","disable_pay_channels":"pcredit,moneyFund,debitCardExpress","agreement_sign_params":{"buckle_app_id":"1001164","sign_validity_period":"2m","buckle_merchant_id":"268820000000414397785","external_logon_id":"13852852877","third_party_type":"PARTNER","personal_product_code":"GENERAL_WITHHOLDING_P","external_agreement_no":"test","promo_params":"{\"key\",\"value\"}","sign_scene":"INDUSTRY|CARRENTAL"},"royalty_info":{"royalty_type":"ROYALTY","royalty_detail_infos":[{"out_relation_id":"20131124001","amount_percentage":"100","amount":0.1,"batch_no":"123","trans_in":"2088101126708402","trans_out_type":"userId","trans_out":"2088101126765726","serial_no":1,"trans_in_type":"userId","desc":"???????1"}]},"store_id":"NJ_001","request_from_url":"https://","passback_params":"merchantBizType%3d3C%26merchantBizNo%3d2016010101111","qrcode_width":100,"goods_detail":[{"goods_name":"ipad","alipay_goods_id":"20010001","quantity":1,"price":2000,"goods_id":"apple-01","goods_category":"34543238","categories_tree":"124868003|126232002|126252004","body":"??????","show_url":"http://www.alipay.com/xxx.jpg"}],"enable_pay_channels":"pcredit,moneyFund,debitCardExpress","out_trade_no":"20150320010101001","total_amount":88.88,"business_params":"{\"data\":\"123\"}","goods_type":"0","promo_params":"{\"storeIdType\":\"1\"}"}
		// });
		
		function recharge(html) {
			var index = layer.open({
				type: 1,
				title: false,
				closeBtn: true,
				area:[ '500px','450px'],
				offset: 'auto',
				shade: 0.1,
				content: html,
				shadeClose: true
			});
		}
		$("body").on("click",".moneyBtn",function() {
			$(".moneyBtn").attr("class","layui-btn layui-btn-primary moneyBtn");
			$(this).attr("class","layui-btn layui-bg-green moneyBtn");
			var money=$(this).text().toString().substring(1);
			alert(money)
		}); 
		
		$(".chooseBtn").on("click",function() {
			$(".chooseBtn").attr("class","layui-btn layui-btn-primary chooseBtn");
			$(this).attr("class","layui-btn layui-bg-green chooseBtn");
		}) 
		function getInfo(orderInfo) {
			$("#landlord_name").empty();
			$("#landlord_name").append('<h2>这是一个抢手房源。'+orderInfo.user_name+'的房源通常很抢手。</h2>');
			$("#house").empty();
			html='<br><div class="layui-col-xs7"><h2><b>'+orderInfo.house_name+'</b></h2><br><h3>'+orderInfo.house_type+'/'+orderInfo.lease_type+'</h3>'+
				'</div><div class="layui-col-xs3"><img src="../../'+orderInfo.allHouseImg.house_img_url+'" width="100px" >'+
				'</div><hr ><br><div ><h2>地址：'+orderInfo.house_address+'</h2><br><h2>人数：'+orderInfo.house_intake+'人</h2><br><h2>时间：'+orderInfo.startTime+'--'+orderInfo.endTime+' </h2>'+
				'<hr ><br><br></div><div class="layui-col-xs6"><h2>￥'+orderInfo.house_price+' x'+orderInfo.dayNumber+'晚</h2></div>'+
				'<div class="layui-col-xs3"><h2>￥'+orderInfo.house_price*orderInfo.dayNumber+'</h2></div><hr ><br><div class="layui-col-xs6"><h2><b>总价	</b></h2>'+
				'</div><div class="layui-col-xs3"><h2>￥'+orderInfo.house_price*orderInfo.dayNumber+'</h2></div>';
			$("#house").append(html);
			$("#notice").empty();
			$("#notice").append('<br><h2 style="margin-left: 20px;"><b>入住须知</b></h2><br><div id="t1"></div>');
			for(let i=0;i<orderInfo.building_name.length;i++) {
				html='<h2>'+orderInfo.building_name[i]+'</h2><br>';
				$("#t1").append(html);
			}	
		}
	</script>
</html>
