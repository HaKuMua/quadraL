<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>我的房源 </title>
		<script src="../../js/comment.js"></script>
		<link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
		<script src="../../js/jquery.min.js"></script>
		<script src="../../layui/layui.all.js"></script>
		<script src="../../layui/layui.js"></script>
		<style type="text/css">
			#navId li a {
				font-size: 15px;
				color: white;
				font-weight: bold;
			}

			#rightNav {
				float: right;
			}

			#main {
				width: 1445px;
				height: 100%;
				margin-left: 220px;
				margin-top: 40px;
			}

			#main img {
				border-radius: 10px;
			}

			.foot {
				margin-top: 180px;
				width: 1090px;
				margin-left: 550px;
			}
		</style>
	</head>
	<body>
		<div id="top">
			<ul class="layui-nav layui-bg-green" id="navId">
				<li class="layui-nav-item">
					<a href="../index.html">
						<img src="../../img/logo.jpg" class="layui-nav-img">
					</a>
				</li>
				<li class="layui-nav-item ">
					<form class="layui-form" action="">
						<input id="topSearch" style=" width: 400px;height:48px; font-weight: bold; font-size: 20px; " name="search"
						 placeholder="搜一搜" autocomplete="off" class="layui-input">
					</form>
				</li>
				<div id="rightNav">
					<li class="layui-nav-item"><a href="">故事</a></li>
					<li class="layui-nav-item" style="cursor: pointer;"><a class="NavA" data-method="login">注册</a></li>
					<li class="layui-nav-item" style="cursor: pointer;"><a class="NavA" data-method="login">登录</a></li>
				</div>
			</ul>
		</div>
		<div id="main">
			<div id="">
				<div class="layui-col-xs4">
					<span style="font-size: 40px;color: gray;font-weight:bolder;">
						我的房源
					</span>
				</div>
			</div><br><br><br><br>
			<table class="layui-hide" id="test" lay-filter="test"></table>
		</div>
		<div class="foot">
			<div>
				<div>京ICP备16017121号-3 京ICP证 160773号
					<img src="https://z1.muscache.cn/airbnb/static/packages/public_security_bureau_logo.d0289dc0.png" alt="中国公安局标志">
					<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502032345" target="_blank" rel="noopener noreferrer"
					 aria-busy="false">京公网安备 11010502032345号</a>
					技术支持：卓应教育（湖南）有限公司 <a href="https://a0.muscache.com/pictures/03ec62da-f467-4e2b-bfee-6eefd052d7f5.jpg" target="_blank"
					 rel="noopener noreferrer" aria-busy="false">营业执照</a></div>
				<div dir="ltr">© 2019 Airbnb, Inc. All rights reserved.</div>
			</div>
			<br><br><br><br><br><br>
		</div>

		<script type="text/html" id="toolbarDemo">
			<div class="layui-btn-container">
		    <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
		    <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
		    <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
		  </div>
		</script>
		<script type="text/html" id="barDemo">
			<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
		  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
		   <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="view">查看</a>
		</script>
		<script type="text/javascript">
			var userInfo = {
				user_id: '1000',
				user_name: 'haku',
				user_img: '../img/timg.jpg',
				user_id: '1001',
				islanlord: 1
			};
			json = getCookie('userInfo');
			if (json != '' || json == null) {
				jsonInfo = JSON.parse(json);
				if (jsonInfo != null) {
					userInfo = jsonInfo;
					$("#myImg").attr("src","../../"+userInfo.user_headimg_url);
					console.log(userInfo);
				}
			}
			
			//初始化导航栏
			if (userInfo.user_id != null) {
				var html = '<li class="layui-nav-item " id="china"> <a href="myOrder.html" >房源订单中心</a></li>' +
					'<li class="layui-nav-item"><a href="../story/index.html">故事</a></li>' +
					'<li class="layui-nav-item"><a href="#" id="notice">消息<span id="dot" class="layui-badge-dot"></span></a> </li>' +
					' <li class="layui-nav-item" lay-unselect=""><a href="javascript:;"><img id="headImg" src="../../'+userInfo.user_headimg_url+'" class="layui-nav-img">' + userInfo.user_name + '</a> ' +
					'<dl class="layui-nav-child"><dd><a href="../host/landlord.html?user_id='+userInfo.user_id+'"  style="color: gray;">个人中心</a></dd>' +
					' <dd><a href="modifyInfo.html" style="color: gray;">修改信息</a></dd><dd><a href="../index.html" id="quit" style="color: gray;">退了</a></dd></dl>';
				$("#rightNav").empty();
				$("#rightNav").append(html);
				if (userInfo.islanlord != 1) {
					$("#china").after('<li class="layui-nav-item "> <a href="">我的房源</a>' +
						'<dl class="layui-nav-child"><dd><a href="../user/landlordOrder.html"  style="color: gray;">订单信息</a></dd>' +
						' <dd><a href="myHouse.html" style="color: gray;">房源信息</a></dd></dl>' + '</li>' +
						'<li class="layui-nav-item "><a href="../host/create_a_room/room.html">添加房源</a></li>');
				} else {
					$("#china").after('<li class="layui-nav-item "> <a href="../host/create_a_room/become.html">成为房东</a></li>');
				}
			}
			//退出按钮监听
			$("body").on("click", "#quit", function() {
				setCookie("userInfo", null, 0.1);
			});
			
			$("#editTel").on("click",function() {
				html='';
			});
			//设置cookie
			function setCookie(cname, cvalue, exdays) {
			    var d = new Date();
			    d.setTime(d.getTime() + (exdays*24*60*60*1000));
			    var expires = "expires="+ d.toUTCString();
			    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
			} 
			//获取Cookie
			function getCookie(cname) {
				var name = cname + "=";
				var decodedCookie = decodeURIComponent(document.cookie);
				var ca = decodedCookie.split(';');
				for (var i = 0; i < ca.length; i++) {
					var c = ca[i];
					while (c.charAt(0) == ' ') {
						c = c.substring(1);
					}
					if (c.indexOf(name) == 0) {
						return c.substring(name.length, c.length);
					}
				}
				return "";
			}
		</script>
		<script>
			layui.use(['table','element'], function() {
				var table = layui.table;
				table.render({
					elem: '#test',
					size: 'lg',
					url: basePath + "house.do?method=getHouseInfoByUserID",
					where: {
						user_id: userInfo.user_id,
					},
					dataType: "json",
					title: '用户数据表',
					limit:10,
					cols: [
						[{
							type: 'checkbox',
							fixed: 'left'
						}, {
							field: 'house_name',
							title: '房源名称',
							width: 130,
							sort: true
						}, {
							field: 'house_address',
							title: '房源详细地址',
							width: 375,
							sort: true
						}, {
							field: 'lease_type',
							title: '出租类型',
							width: 120,
							edit: 'text'
						}, {
							field: 'house_intake',
							title: '房子容纳量',
							width: 120,
							sort: true
						}, {
							field: 'may_check_in_date',
							edit: 'text',
							title: ' 可入住时间',
							width: 110
						}, {
							field: 'may_check_out_date',
							edit: 'text',
							title: '可退房时间',
							width: 110
						}, {
							field: 'house_type',
							title: '房子类型',
							width: 120,
							sort: true
						}, {
							field: 'house_price',
							title: '房子价格',
							width: 120,
							edit: 'text',
							sort: true
						}, 
						{
							fixed: 'right',
							title: '操作',
							toolbar: '#barDemo',
							width: 180
						}]
					],
					page: true,
					parseData: function(res) {
						return {
							"code": res.status,
							"msg": res.msg,
							"data": res.data
						};
					}
				});

				//监听行工具事件
				table.on('tool(test)', function(obj) {
					var data = obj.data;
					//console.log(obj)
					if (obj.event === 'del') {
						layer.confirm('真的删除行么', function(index) {
							obj.del();
							layer.close(index);
						});
					} else if (obj.event === 'edit') {
						layer.prompt({
							formType: 2,
							value: data.email
						}, function(value, index) {
							obj.update({
								email: value
							});
							layer.close(index);
						});
					}
				});
			});
		</script>
	</body>
	
</html>
